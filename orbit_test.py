import numpy as np
import matplotlib.pyplot as plt

# Constants
G = 6.67430e-11      # m^3/kg/s^2
M_earth = 5.972e24   # kg

# Simulation parameters
N = 100
dt = 73.032579775069948

# Initial conditions
r0 = np.array([0, 6378137*2])  # meters
v0 = np.array([5000, 0])       # m/s

# Optional 2D thrust array (ax, ay per timestep)
thrust_array = np.zeros((N, 2))  # no thrust for now

# Optional thrust array (m/s^2 per timestep)
a0 = 9.798285479187300
# Thrust array (N x 2)
thrust_array = np.array([
#[0.006767722137,-0.510293358019],[0.505917135600,-0.510293358019],[0.509954737080,-0.510293358019],[0.510257603535,-0.510293358019],[0.036971800582,-0.510043393628],[0.065901297270,-0.494624371650],[0.035562192320,-0.325272828243],[-0.015010813687,-0.117522679461],[0.006788777364,-0.091070613765],[0.003133126298,-0.053301673051],[0.003045314591,-0.022270907886],[0.042419733118,-0.041607720083],[-0.024626158895,-0.133161483649],[0.036679701750,-0.114819800940],[0.077776595054,-0.039461971615],[0.021063853658,-0.147318124877],[0.044851979809,-0.133481506898],[-0.092276892435,-0.227744477698],[0.040414084925,-0.155677595876],[-0.032313961081,-0.189493959734],[0.067046239124,-0.165152597231],[-0.003191417008,-0.158153329706],[0.008547886134,-0.010584302762],[-0.029556814348,-0.031606009086],[0.003001947880,-0.040605320528],[-0.002182117781,-0.035088159650],[0.006469501075,-0.031502494074],[0.024763427428,-0.063126083114],[0.000002966055,-0.000027581853],[0.000318652739,-0.005483615552],[0.000132643344,-0.000267697418],[-0.001558999185,-0.008353948637],[0.000029282969,-0.000123369055],[-0.000017000408,-0.000194705722],[0.007513436039,-0.010704812547],[-0.012816914785,-0.028537049744],[0.000001290522,-0.000018255447],[0.000026932878,-0.000020473023],[-0.011774242870,-0.010810563380],[0.000022568717,-0.000019691216],[-0.000030339357,-0.000065818892],[-0.004215229546,-0.013464794327],[-0.000020958175,-0.000033950803],[-0.000395466035,0.000513841341],[-0.002427282711,0.001829613861],[-0.029699240935,-0.009153194117],[-0.003801678650,-0.000423701482],[-0.000131798915,0.000000572745],[0.000008588091,0.000007150656],[-0.000179509917,-0.000116909107],[-0.050195904058,0.054835573479],[-0.031774397472,0.001300196669],[0.000058913535,0.000044381965],[-0.000096136665,0.000023845271],[-0.024449549815,-0.020458780514],[-0.001084781330,0.001376118828],[-0.094107891942,0.072521356255],[-0.034042719202,0.017376282415],[-0.002756261698,0.000379941386],[-0.050987882578,0.033082266203],[-0.000690429865,0.090172148935],[0.000043187404,0.000117427654],[-0.059541169823,0.031841831957],[0.001950990936,0.153979090002],[-0.000083003621,0.000069780165],[-0.096633681246,-0.006493779549],[-0.037317979049,0.072034450614],[-0.087564050589,0.063250811900],[-0.149201122757,0.127315497045],[-0.026922495043,0.059352099848],[-0.010332332154,0.024396077994],[-0.218085169194,0.112807443631],[-0.024690264187,0.215220575673],[-0.023510854747,0.197339813297],[-0.028858348510,0.090966208952],[-0.020724358795,0.015613236902],[-0.003057605422,0.010702798591],[-0.000036163197,0.000081143306],[-0.015583192145,0.014836323045],[-0.006272535988,0.017192200754],[-0.056223603130,0.054450055582],[-0.116244495863,0.139279012445],[-0.048415229084,0.091590511023],[-0.041736642125,0.084661269909],[-0.228652287768,0.300684212630],[-0.083249325251,0.257561169455],[-0.101689447595,0.239230472017],[-0.201419070555,0.235015201603],[-0.068668079887,0.359543318060],[-0.238079652736,0.347579548310],[-0.113584487497,0.362467567339],[-0.062205844691,0.100088098142],[-0.176628065985,0.307630911151],[-0.101182451672,0.221585609810],[-0.152616003767,0.338957231869],[-0.130976327132,0.343839760141],[-0.268081168354,0.349019407192],[-0.219088709585,0.363841370979],[-0.258720686732,0.375251061982],[-0.167588066348,0.338322553186]
[0.37332076,-0.06326626],[0.08759666,0.00441445],[0.15483357,0.06787102],[0.21814810,0.12973566],[-0.00000490,-0.00001352],[-0.00000506,-0.00000936],[-0.00001342,-0.00000407],[-0.00000705,-0.00000539],[0.00000129,-0.00001191],[-0.00001045,0.00000397],[-0.00000162,0.00000494],[0.00002404,-0.00001789],[-0.00001038,-0.00000727],[-0.00000289,0.00000116],[-0.00002151,-0.00000507],[-0.00000212,-0.00000294],[-0.00000506,0.00000972],[0.00000307,0.00000518],[-0.00001118,0.00000057],[-0.00001124,0.00000387],[0.00000835,-0.00000864],[0.00000828,0.00000628],[-0.00000355,-0.00000523],[0.00001123,-0.00001074],[-0.00000285,0.00000566],[-0.00000613,-0.00000290],[0.00000109,-0.00000295],[0.00000169,0.00001367],[0.00000297,-0.00000814],[0.00000846,0.00004261],[0.00000353,-0.00001495],[-0.00000325,0.00000645],[0.00000085,0.00000223],[0.00000241,-0.00000331],[-0.00001304,0.00000550],[-0.00000253,0.00002128],[0.00000672,0.00000468],[0.00000242,0.00001071],[0.00001404,0.00000827],[-0.00000358,-0.00000000],[-0.00000880,0.00001153],[-0.00000139,0.00000060],[0.00002031,-0.00000074],[-0.00001347,-0.00000622],[-0.00000077,-0.00000252],[0.00000418,0.00000101],[-0.00001313,0.00002363],[0.00000863,0.00001765],[0.00000449,-0.00000454],[-0.00000584,0.00000481],[0.00000586,-0.00000140],[0.00000651,-0.00000619],[0.00000730,0.00002551],[-0.00000622,0.00001531],[0.00001335,-0.00000219],[0.00003387,0.00000458],[0.00000884,0.00000863],[0.00000849,-0.00000306],[-0.00000361,-0.00000436],[0.00000303,-0.00000357],[0.00002991,-0.00000975],[-0.00000314,0.00000555],[-0.00001135,-0.00000346],[0.00001420,0.00000833],[0.00000282,-0.00000210],[-0.00000267,-0.00001276],[-0.00000816,0.00000041],[0.00000643,0.00000850],[0.00000523,0.00002283],[0.00000595,0.00000012],[-0.00002262,0.00025119],[0.00002054,0.00000396],[0.00001313,-0.00000285],[0.00001120,0.00000961],[0.00026962,-0.00007737],[0.00001838,-0.00001582],[0.00011152,0.00010105],[0.00001205,0.00001736],[0.00001233,0.00000995],[0.00000473,0.00000247],[0.00000896,0.00001298],[0.00001224,0.00001075],[0.00011052,0.00003294],[0.00082559,-0.00010713],[0.00397115,-0.00005414],[0.01049194,-0.00053310],[0.01630321,-0.00121979],[0.01773759,-0.00105311],[0.01820700,-0.00183467],[0.03182806,-0.00424730],[0.04235872,-0.00495029],[0.05020867,-0.01051629],[0.04993784,-0.00953904],[0.06143338,-0.01237246],[0.06559870,-0.01766978],[0.07066194,-0.02267036],[0.08391462,-0.02333553],[0.10115516,-0.03207518],[0.10962934,-0.03494800],[0.11812399,-0.04338251]


]) * a0

# Example: small thrust in x then y
#thrust_array[:N//2, 0] = 0.001
#thrust_array[N//2:, 1] = 0.001

# RK4 step function
def rk4_step(r, v, dt, thrust=np.array([0.0, 0.0])):
    def accel(r):
        r_norm = np.linalg.norm(r)
        a_grav = -G*M_earth * r / r_norm**3
        return a_grav + thrust

    k1v = accel(r) * dt
    k1r = v * dt

    k2v = accel(r + 0.5*k1r) * dt
    k2r = (v + 0.5*k1v) * dt

    k3v = accel(r + 0.5*k2r) * dt
    k3r = (v + 0.5*k2v) * dt

    k4v = accel(r + k3r) * dt
    k4r = (v + k3v) * dt

    r_next = r + (k1r + 2*k2r + 2*k3r + k4r)/6
    v_next = v + (k1v + 2*k2v + 2*k3v + k4v)/6
    return r_next, v_next

# Storage arrays
r_arr = np.zeros((N+1, 2))
v_arr = np.zeros((N+1, 2))
r_arr[0] = r0
v_arr[0] = v0

# RK4 integration loop
for i in range(N):
    thrust = thrust_array[i]
    r_next, v_next = rk4_step(r_arr[i], v_arr[i], dt, thrust)
    r_arr[i+1] = r_next
    v_arr[i+1] = v_next

# Plot the orbit
plt.figure(figsize=(6,6))
plt.plot(r_arr[:,0], r_arr[:,1], '-o', markersize=2, label='Orbit')
plt.plot(0,0,'yo', markersize=10, label='Earth')
plt.xlabel('x (m)')
plt.ylabel('y (m)')
plt.axis('equal')
plt.grid(True)
plt.title('2D Orbit with RK4 Propagation')
plt.legend()
plt.show()

